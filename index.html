<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Coach Sportif Personnel</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
/**
 * INDEX.HTML - Version corrig√©e et robuste
 * - Envoie username syst√©matiquement dans les POST
 * - G√®re les erreurs de fetch / response
 * - Prot√®ge contre userData null/undefined
 * - Remplace classes Tailwind dynamiques par mapping
 */

const { useState, useEffect } = React;

/* CONFIGS */
const EXERCISES_CONFIG = {
    pompes: {
        name: "Pompes",
        icon: "üí™",
        unit: "r√©p√©titions",
        color: "blue",
        levels: {
            debutant: { min: 5, max: 15 },
            intermediaire: { min: 15, max: 30 },
            pro: { min: 30, max: 50 }
        }
    },
    gainage: {
        name: "Gainage",
        icon: "üßò",
        unit: "secondes",
        color: "purple",
        levels: {
            debutant: { min: 20, max: 40 },
            intermediaire: { min: 40, max: 90 },
            pro: { min: 90, max: 180 }
        }
    },
    crunch: {
        name: "Crunch",
        icon: "üî•",
        unit: "r√©p√©titions",
        color: "orange",
        levels: {
            debutant: { min: 10, max: 20 },
            intermediaire: { min: 20, max: 40 },
            pro: { min: 40, max: 80 }
        }
    },
    squats: {
        name: "Squats",
        icon: "ü¶µ",
        unit: "r√©p√©titions",
        color: "green",
        levels: {
            debutant: { min: 10, max: 20 },
            intermediaire: { min: 20, max: 40 },
            pro: { min: 40, max: 70 }
        }
    }
};

const LEVELS = {
    debutant: { name: "D√©butant", icon: "üå±", description: "Je commence le sport" },
    intermediaire: { name: "Interm√©diaire", icon: "üí™", description: "Je suis actif r√©guli√®rement" },
    pro: { name: "Pro", icon: "üèÜ", description: "Je m'entra√Æne intens√©ment" }
};

/* Util - mapping couleur -> classes Tailwind */
const COLOR_CLASS = {
    blue: { bg: 'bg-blue-500', from: 'from-blue-500', to: 'to-blue-600' },
    purple: { bg: 'bg-purple-500', from: 'from-purple-500', to: 'to-purple-600' },
    orange: { bg: 'bg-orange-500', from: 'from-orange-500', to: 'to-orange-600' },
    green: { bg: 'bg-green-500', from: 'from-green-500', to: 'to-green-600' }
};

/* DEFAULT USER TEMPLATE */
function makeDefaultUser(username, level = 'debutant', exercises = ['pompes', 'gainage']) {
    const targets = {};
    const exerciseStats = {};
    exercises.forEach(ex => {
        const cfg = EXERCISES_CONFIG[ex];
        const lvlCfg = cfg.levels[level];
        // set target at the midpoint between min and max rounded
        targets[ex] = Math.round((lvlCfg.min + lvlCfg.max) / 2);
        exerciseStats[ex] = { successCount: 0, totalAttempts: 0 };
    });

    return {
        username,
        level,
        exercises,
        targets,
        exerciseStats,
        streak: 0,
        totalDays: 0,
        lastCheckDate: null
    };
}

/* Main App */
function FitnessTracker() {
    const [username, setUsername] = useState('');
    const [tempUsername, setTempUsername] = useState('');
    const [userData, setUserData] = useState(null);
    const [completedExercises, setCompletedExercises] = useState(new Set());
    const [showConfirmation, setShowConfirmation] = useState(false);
    const [selectedExercises, setSelectedExercises] = useState([]);
    const [selectedLevel, setSelectedLevel] = useState('');
    const [setupStep, setSetupStep] = useState('exercises'); // 'exercises' | 'level' | 'done'
    const [error, setError] = useState('');
    const [loading, setLoading] = useState(false);
    const [showLeaderboard, setShowLeaderboard] = useState(false);
    const [leaderboard, setLeaderboard] = useState([]);

    /* Helper: safe fetch with json parsing */
    async function safeFetch(url, options = {}) {
        try {
            const res = await fetch(url, options);
            if (!res.ok) {
                const text = await res.text().catch(() => '');
                throw new Error(`HTTP  $ {res.status} -  $ {text || res.statusText}`);
            }
            const contentType = res.headers.get('content-type') || '';
            if (contentType.includes('application/json')) {
                return await res.json();
            } else {
                return null;
            }
        } catch (err) {
            throw err;
        }
    }

    /* Load from backend if username in localStorage */
    useEffect(() => {
        const stored = localStorage.getItem('ft_username');
        if (stored) {
            setUsername(stored);
            loadUser(stored);
        } else {
            setLoading(false);
        }
    }, []);

    async function loadUser(name) {
        setLoading(true);
        setError('');
        try {
            // try GET user from function
            const data = await safeFetch(`/.netlify/functions/user-data?username= $ {encodeURIComponent(name)}`);
            if (data && data.username) {
                setUserData(data);
            } else {
                // create default user if backend returns nothing
                const defaultUser = makeDefaultUser(name);
                setUserData(defaultUser);
                // send to backend (POST create)
                await safeFetch('/.netlify/functions/user-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: name, user: defaultUser })
                });
            }
            setUsername(name);
            localStorage.setItem('ft_username', name);
        } catch (err) {
            console.error('Erreur loadUser', err);
            setError('Impossible de charger le profil (v√©rifie la fonction Netlify).');
        } finally {
            setLoading(false);
        }
    }

    /* Login / Cr√©ation */
    async function handleLogin() {
        const name = (tempUsername || '').trim();
        if (!/^[\w-]{3,} $ /.test(name)) {
            setError('Pseudo invalide ‚Äî min 3 caract√®res, lettres/chiffres/_/- seulement.');
            return;
        }
        setError('');
        await loadUser(name);
    }

    function handleLogout() {
        setUsername('');
        setTempUsername('');
        setUserData(null);
        setCompletedExercises(new Set());
        localStorage.removeItem('ft_username');
    }

    /* Load leaderboard */
    async function loadLeaderboard() {
        setLoading(true);
        setError('');
        try {
            const data = await safeFetch('/.netlify/functions/user-data');
            if (Array.isArray(data)) {
                // sample sort: by streak desc then totalDays desc (backend may provide different metric)
                const sorted = data.slice().sort((a, b) => (b.streak || 0) - (a.streak || 0) || (b.totalDays || 0) - (a.totalDays || 0));
                setLeaderboard(sorted);
            } else {
                setLeaderboard([]);
            }
        } catch (err) {
            console.error('Erreur leaderboard:', err);
            setError('Impossible de charger le classement.');
            setLeaderboard([]);
        } finally {
            setLoading(false);
        }
    }

    /* Reset progress (DELETE) */
    async function resetProgress() {
        if (!username) return;
        if (!confirm('‚ö†Ô∏è Supprimer ton compte et toutes tes donn√©es ?')) return;
        setLoading(true);
        try {
            await safeFetch(`/.netlify/functions/user-data?username= $ {encodeURIComponent(username)}`, { method: 'DELETE' });
            handleLogout();
            alert('‚úÖ Compte supprim√© !');
        } catch (err) {
            console.error('Erreur reset:', err);
            alert('‚ùå Erreur lors de la suppression');
        } finally {
            setLoading(false);
        }
    }

    /* Toggle exercise completed */
    function toggleCompleted(exKey) {
        setCompletedExercises(prev => {
            const copy = new Set(prev);
            if (copy.has(exKey)) copy.delete(exKey);
            else copy.add(exKey);
            return copy;
        });
    }

    /* Validate session (appliqu√©e apr√®s confirmation) */
    async function validateSession() {
        if (!userData || !username) return;
        setShowConfirmation(false);
        setLoading(true);
        setError('');
        try {
            const today = new Date().toISOString().split('T')[0];
            const level = userData.level;
            const newTargets = {...userData.targets};
            const newStats = {...userData.exerciseStats};

            // Ensure every exercise has stats
            userData.exercises.forEach(ex => {
                if (!newStats[ex]) newStats[ex] = { successCount: 0, totalAttempts: 0 };
            });

            // Determine whether all exercises were completed -> streak increment
            const allSuccess = userData.exercises.every(ex => completedExercises.has(ex));
            // Update counts
            userData.exercises.forEach(ex => {
                const wasCompleted = completedExercises.has(ex);
                const cfg = EXERCISES_CONFIG[ex];
                const levelCfg = cfg.levels[level];
                const currentTarget = Number(userData.targets && userData.targets[ex] ? userData.targets[ex] : Math.round((levelCfg.min+levelCfg.max)/2));

                // Update attempts/stats
                newStats[ex] = {
                    successCount: (newStats[ex].successCount || 0) + (wasCompleted ? 1 : 0),
                    totalAttempts: (newStats[ex].totalAttempts || 0) + 1
                };

                // Increase or decrease targets
                if (wasCompleted) {
                    newTargets[ex] = Math.min(Math.round(currentTarget * 1.1), levelCfg.max);
                } else {
                    newTargets[ex] = Math.max(Math.round(currentTarget * 0.85), levelCfg.min);
                }
            });

            const newUser = {
                ...userData,
                targets: newTargets,
                exerciseStats: newStats,
                lastCheckDate: today,
                totalDays: (userData.totalDays || 0) + 1,
                streak: allSuccess ? (userData.streak || 0) + 1 : 0
            };

            setUserData(newUser);
            // Reset completed selection
            setCompletedExercises(new Set());

            // Send update to backend via POST (include username)
            await safeFetch('/.netlify/functions/user-data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, user: newUser })
            });

            alert('‚úÖ S√©ance enregistr√©e !');
        } catch (err) {
            console.error('Erreur validateSession', err);
            setError('Erreur lors de l‚Äôenregistrement de la s√©ance.');
        } finally {
            setLoading(false);
        }
    }

    /* Validate whole day (old function in your code) kept for compatibility */
    async function validateDay() {
        // alias to validateSession for clarity
        setShowConfirmation(true);
    }

    /* Setup new user flow: select exercises, level */
    async function finishSetup() {
        if (!tempUsername || !selectedLevel || selectedExercises.length === 0) {
            setError('Remplis toutes les informations.');
            return;
        }
        const name = tempUsername.trim();
        const newUser = makeDefaultUser(name, selectedLevel, selectedExercises);
        setUserData(newUser);
        setUsername(name);
        localStorage.setItem('ft_username', name);

        setLoading(true);
        try {
            await safeFetch('/.netlify/functions/user-data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: name, user: newUser })
            });
            setSetupStep('done');
            setError('');
            alert('‚úÖ Profil cr√©√© !');
        } catch (err) {
            console.error('Erreur finishSetup', err);
            setError('Impossible de cr√©er le profil. V√©rifie la fonction Netlify.');
        } finally {
            setLoading(false);
        }
    }

    /* Rendering components */
    // If loading initial
    if (loading && !userData) {
        return (
            <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-6">
                <div className="max-w-2xl mx-auto text-center bg-white rounded-2xl p-8 shadow-lg">
                    <h1 className="text-2xl font-bold mb-4">Chargement‚Ä¶</h1>
                    <p className="text-gray-600">On v√©rifie ton profil. Patiente quelques secondes.</p>
                </div>
            </div>
        );
    }

    // If no username -> show login / setup
    if (!username) {
        return (
            <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-6">
                <div className="max-w-xl mx-auto">
                    <div className="bg-white rounded-2xl p-8 shadow-lg">
                        <h1 className="text-2xl font-bold mb-4">Coach Sportif Personnel</h1>
                        <p className="text-gray-600 mb-4">Entre ton pseudo pour commencer</p>

                        <input
                            value={tempUsername}
                            onChange={(e)=> setTempUsername(e.target.value)}
                            onKeyPress={(e)=> e.key === 'Enter' && handleLogin()}
                            placeholder="Choisis ton pseudo"
                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 text-lg focus:border-blue-500 focus:outline-none"
                            autoFocus
                        />
                        <button
                            onClick={handleLogin}
                            className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg text-lg font-semibold hover:shadow-xl transition-all"
                        >C'est parti ! üöÄ</button>

                        <p className="text-sm text-gray-500 text-center mt-4">
                            Min 3 caract√®res ‚Ä¢ Lettres, chiffres, - et _ uniquement
                        </p>

                        {error && <p className="mt-4 text-red-600">{error}</p>}
                    </div>

                    {/* Option quick setup if user wants to configure exercises */}
                    <div className="mt-6 text-center text-white">
                        <p>Tu veux choisir tes exercices et ton niveau ?</p>
                        <div className="mt-3 flex gap-3 justify-center">
                            <button onClick={() => { setSetupStep('exercises'); setTempUsername(''); setSelectedExercises([]); setSelectedLevel('debutant'); }}
                                    className="px-4 py-2 bg-yellow-400 rounded-lg font-semibold">Configurer</button>
                        </div>
                    </div>

                    {/* Setup Modal inline */}
                    {setupStep && (
                        <div className="mt-6 bg-white rounded-2xl p-6 shadow">
                            <h2 className="text-xl font-bold mb-4">Configuration rapide</h2>
                            <input
                                value={tempUsername}
                                onChange={(e)=> setTempUsername(e.target.value)}
                                placeholder="Ton pseudo"
                                className="w-full px-3 py-2 border rounded mb-3"
                            />
                            <div className="mb-3">
                                <h3 className="font-semibold mb-2">Choisis tes exercices</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    {Object.entries(EXERCISES_CONFIG).map(([key, ex]) => (
                                        <button key={key}
                                                onClick={() => {
                                                    setSelectedExercises(prev => prev.includes(key) ? prev.filter(e => e !== key) : [...prev, key]);
                                                }}
                                                className={`p-4 rounded-lg text-left border  $ {selectedExercises.includes(key) ? 'bg-blue-50 border-blue-300' : 'bg-gray-50 hover:bg-gray-100'}`}>
                                            <div className="text-2xl">{ex.icon} <span className="ml-2 font-bold">{ex.name}</span></div>
                                            <div className="text-sm text-gray-600">{ex.unit}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="mb-3">
                                <h3 className="font-semibold mb-2">Niveau</h3>
                                <div className="flex gap-2">
                                    {Object.entries(LEVELS).map(([k, v]) => (
                                        <button key={k}
                                                onClick={() => setSelectedLevel(k)}
                                                className={`px-3 py-2 rounded  $ {selectedLevel === k ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white' : 'bg-gray-100'}`}>
                                            {v.icon} {v.name}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="flex gap-3">
                                <button onClick={() => { setSetupStep('exercises'); }} className="flex-1 bg-gray-200 py-3 rounded">Annuler</button>
                                <button onClick={finishSetup} className="flex-1 bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded">Cr√©er</button>
                            </div>
                            {error && <p className="mt-3 text-red-600">{error}</p>}
                        </div>
                    )}
                </div>
            </div>
        );
    }

    // If userData not loaded yet but username present, show fallback
    if (!userData) {
        return (
            <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-6">
                <div className="max-w-2xl mx-auto text-center bg-white rounded-2xl p-8 shadow-lg">
                    <h1 className="text-2xl font-bold mb-4">Chargement du profil‚Ä¶</h1>
                    <p className="text-gray-600">Rafra√Æchis la page si √ßa bloque.</p>
                    <div className="mt-4">
                        <button onClick={() => loadUser(username)} className="px-4 py-2 bg-blue-500 text-white rounded">Recharger</button>
                        <button onClick={handleLogout} className="ml-3 px-4 py-2 bg-gray-300 rounded">Se d√©connecter</button>
                    </div>
                    {error && <p className="mt-4 text-red-600">{error}</p>}
                </div>
            </div>
        );
    }

    /* MAIN DASHBOARD */
    const today = new Date().toISOString().split('T')[0];
    const canValidate = !userData.lastCheckDate || userData.lastCheckDate !== today;
    const totalExercises = userData.exercises.length;
    const totalAttempts = Object.values(userData.exerciseStats || {}).reduce((s, st) => s + (st.totalAttempts || 0), 0);
    const totalSuccess = Object.values(userData.exerciseStats || {}).reduce((s, st) => s + (st.successCount || 0), 0);
    const successRate = totalAttempts > 0 ? Math.round((totalSuccess / totalAttempts) * 100) : 0;

    return (
        <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-4">
            <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                    <div className="flex justify-between items-center mb-4">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-800">Salut {username} ! üëã</h1>
                            <p className="text-gray-600">Pr√™t pour ta s√©ance du jour ?</p>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => { setShowLeaderboard(true); loadLeaderboard(); }} className="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-all text-sm font-semibold">üèÜ Classement</button>
                            <button onClick={handleLogout} className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-all text-sm">üö™ D√©connexion</button>
                            <button onClick={resetProgress} className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all text-sm">üîÑ Reset</button>
                        </div>
                    </div>

                    <div className="grid grid-cols-3 gap-4">
                        <div className="bg-gradient-to-br from-orange-400 to-red-500 rounded-xl p-4 text-white">
                            <div className="text-3xl mb-1">üî•</div>
                            <div className="text-2xl font-bold">{userData.streak || 0}</div>
                            <div className="text-sm opacity-90">S√©rie</div>
                        </div>
                        <div className="bg-gradient-to-br from-green-400 to-blue-500 rounded-xl p-4 text-white">
                            <div className="text-3xl mb-1">üìÖ</div>
                            <div className="text-2xl font-bold">{userData.totalDays || 0}</div>
                            <div className="text-sm opacity-90">Jours</div>
                        </div>
                        <div className="bg-gradient-to-br from-purple-400 to-pink-500 rounded-xl p-4 text-white">
                            <div className="text-3xl mb-1">üìä</div>
                            <div className="text-2xl font-bold">{successRate}%</div>
                            <div className="text-sm opacity-90">R√©ussite</div>
                        </div>
                    </div>
                </div>

                {/* Exercises */}
                <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                    <h2 className="text-2xl font-bold mb-4">S√©ance du jour</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {userData.exercises.map(exKey => {
                            const cfg = EXERCISES_CONFIG[exKey];
                            const target = userData.targets && userData.targets[exKey] ? userData.targets[exKey] : (cfg.levels[userData.level] ? Math.round((cfg.levels[userData.level].min + cfg.levels[userData.level].max)/2) : 0);
                            const isCompleted = completedExercises.has(exKey);
                            const colorClasses = COLOR_CLASS[cfg.color] || COLOR_CLASS.blue;
                            return (
                                <div key={exKey}
                                     onClick={() => toggleCompleted(exKey)}
                                     className={`p-6 rounded-xl cursor-pointer transition-all  $ {isCompleted ? ` $ {colorClasses.bg} text-white scale-105 shadow-lg` : 'bg-gray-50 hover:bg-gray-100'}`}
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-4">
                                            <div className="text-4xl">{cfg.icon}</div>
                                            <div>
                                                <h3 className="text-2xl font-bold mb-1">{cfg.name}</h3>
                                                <p className="text-lg font-semibold">Objectif: {target} {cfg.unit}</p>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-sm text-gray-700">{isCompleted ? '‚úì R√©ussi' : 'Non fait'}</div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    <div className="mt-6 flex gap-3">
                        <button disabled={!canValidate} onClick={() => setShowConfirmation(true)} className={`flex-1 py-3 rounded-lg font-bold text-white  $ {canValidate ? 'bg-gradient-to-r from-green-500 to-blue-500 hover:shadow-xl' : 'bg-gray-300 text-gray-600 cursor-not-allowed'}`}>Valider ‚úì</button>
                        <button onClick={() => { setCompletedExercises(new Set(userData.exercises)); alert('‚úÖ Marqu√© tout comme r√©ussi (local)'); }} className="px-4 py-3 bg-blue-200 rounded-lg font-semibold">Tout cocher</button>
                        <button onClick={() => { setCompletedExercises(new Set()); alert('üîÅ R√©initialis√©'); }} className="px-4 py-3 bg-gray-200 rounded-lg">R√©initialiser</button>
                    </div>

                    <div className="mt-6 bg-yellow-50 border-2 border-yellow-400 rounded-lg p-4">
                        <p className="text-sm text-gray-700">
                            üìä Les exercices r√©ussis : <strong>+10%</strong><br/>
                            ‚ùå Les exercices rat√©s : <strong>-15%</strong>
                        </p>
                    </div>
                </div>

                {/* Info & Tips */}
                <div className="bg-white rounded-2xl shadow-xl p-6">
                    <div className="flex justify-between items-start">
                        <div>
                            <h3 className="text-xl font-bold text-gray-800 mb-2">Statistiques</h3>
                            <p className="text-gray-600 mb-1">Jours enregistr√©s : <strong>{userData.totalDays || 0}</strong></p>
                            <p className="text-gray-600 mb-1">R√©ussite globale : <strong>{successRate}%</strong></p>
                        </div>
                        <div className="text-right">
                            <button onClick={() => { setShowLeaderboard(true); loadLeaderboard(); }} className="px-4 py-2 bg-yellow-400 rounded-lg">Voir le classement</button>
                        </div>
                    </div>

                    <div className="mt-6 bg-blue-50 rounded-xl p-6">
                        <h3 className="text-xl font-bold text-gray-800 mb-4">Comment √ßa marche ? üí°</h3>
                        <div className="text-left space-y-2">
                            <p className="text-gray-700">‚úì Clique sur "Valider ‚úì" apr√®s chaque exercice r√©ussi</p>
                            <p className="text-gray-700">üìä R√©ussite : +10% sur cet exercice (max du niveau)</p>
                            <p className="text-gray-700">‚ùå √âchec : -15% pour te relancer (min du niveau)</p>
                            <p className="text-gray-700">üî• Les s√©ries se comptent quand TOUS les objectifs sont r√©ussis</p>
                            <p className="text-gray-700">‚ö†Ô∏è Tu peux valider m√™me si tu n'as pas tout fait</p>
                            <p className="text-gray-700">üèÜ Compare tes performances avec les autres dans le classement</p>
                        </div>
                    </div>
                </div>

                {/* Confirmation Modal */}
                {showConfirmation && (
                    <div className="fixed inset-0 bg-black/30 flex items-center justify-center p-4">
                        <div className="bg-white rounded-xl p-6 max-w-lg w-full shadow-lg">
                            <h3 className="text-xl font-bold mb-3">Valider la s√©ance ?</h3>
                            <p className="text-gray-700 mb-4">Tu vas enregistrer ta s√©ance et mettre √† jour tes objectifs.</p>
                            <div className="flex gap-3">
                                <button onClick={() => setShowConfirmation(false)} className="flex-1 bg-gray-200 py-3 rounded-lg">Annuler</button>
                                <button onClick={validateSession} className="flex-1 bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-lg">Valider ‚úì</button>
                            </div>
                        </div>
                    </div>
                )}

                {/* Leaderboard modal */}
                {showLeaderboard && (
                    <div className="fixed inset-0 bg-black/30 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl p-8 max-w-4xl w-full shadow-xl">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-3xl font-bold text-gray-800">üèÜ Classement</h2>
                                <button onClick={() => setShowLeaderboard(false)} className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-all">‚Üê Retour</button>
                            </div>

                            {leaderboard.length === 0 ? (
                                <p className="text-gray-600">Aucun classement disponible ‚Äî essaie de recharger.</p>
                            ) : (
                                <div className="space-y-3">
                                    {leaderboard.map((u, idx) => {
                                        const isCurrent = u.username === username;
                                        return (
                                            <div key={u.username} className={`flex items-center justify-between p-4 rounded-xl  $ {isCurrent ? 'bg-blue-50 border-2 border-blue-500' : 'bg-gray-50'}`}>
                                                <div className="flex items-center gap-4 flex-1">
                                                    <span className={`text-2xl font-bold min-w-[40px]  $ {idx === 0 ? 'text-yellow-500' : (idx === 1 ? 'text-gray-400' : (idx === 2 ? 'text-orange-600' : 'text-gray-600'))}`}>{idx+1}</span>
                                                    <div className="flex-1">
                                                        <p className="font-bold text-lg">{u.username}</p>
                                                        <p className="text-sm text-gray-600">{LEVELS[u.level] ? ` $ {LEVELS[u.level].icon}  $ {LEVELS[u.level].name}` : '‚Äî'}</p>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <p className="font-semibold">{u.streak || 0} üî•</p>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                )}

                {error && <p className="mt-4 text-red-600">{error}</p>}
            </div>
        </div>
    );
}

ReactDOM.render(<FitnessTracker />, document.getElementById('root'));
</script>
</body>
</html>
